<ng-container *ngIf="pageState$ | async as state">
  <main class="page" *ngIf="state.status === 'ready'">
    <div class="toolbar">
      <button *ngIf="!isEditMode" type="button" (click)="startEdit(state.profile)">Edit profile</button>
    </div>

    <form
      class="edit-form"
      *ngIf="isEditMode && editDraft as draft"
      (ngSubmit)="saveProfile(state.profile.id)"
    >
      <label>
        Name
        <input type="text" name="name" [(ngModel)]="draft.name" required />
      </label>

      <label>
        Headline
        <input type="text" name="headline" [(ngModel)]="draft.headline" required />
      </label>

      <section class="cards-editor">
        <h3>Cards</h3>
        <div class="card-editor-row" *ngFor="let card of draft.cards; let i = index">
          <label>
            Card Id
            <input type="text" [name]="'card-id-' + i" [(ngModel)]="card.id" required />
          </label>
          <label>
            Label
            <input type="text" [name]="'card-label-' + i" [(ngModel)]="card.label" required />
          </label>
          <label>
            URL
            <input type="text" [name]="'card-href-' + i" [(ngModel)]="card.href" required />
          </label>
        </div>
      </section>

      <p class="error" *ngIf="saveError">{{ saveError }}</p>

      <div class="form-actions">
        <button type="submit" [disabled]="isSaving">{{ isSaving ? 'Saving...' : 'Save' }}</button>
        <button type="button" (click)="cancelEdit()" [disabled]="isSaving">Cancel</button>
      </div>
    </form>

    <ng-container *ngIf="!isEditMode">
      <app-profile-header [name]="state.profile.name" [headline]="state.profile.headline"></app-profile-header>
      <app-card-grid [cards]="state.profile.cards"></app-card-grid>
    </ng-container>
  </main>
  <main class="page" *ngIf="state.status === 'loading'">
    <p>Loading...</p>
  </main>
  <main class="page" *ngIf="state.status === 'missing'">
    <p>Profile not found.</p>
  </main>
</ng-container>
